import{_ as s,c as n,o as a,a as l}from"./app.1b85acd6.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"repo","slug":"repo","link":"#repo","children":[{"level":3,"title":"发布包","slug":"发布包","link":"#发布包","children":[]}]},{"level":2,"title":"pack","slug":"pack","link":"#pack","children":[]}],"relativePath":"packagetools/turbo/index.md"}'),p={name:"packagetools/turbo/index.md"},o=l(`<h2 id="repo" tabindex="-1"><a href="https://turbo.build/repo/docs" target="_blank" rel="noreferrer">repo</a> <a class="header-anchor" href="#repo" aria-hidden="true">#</a></h2><p>用 pnpm 来创建项目</p><div class="language-cmd"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">E:\\其他项目</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">pnpm dlx create</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">turbo@latest</span></span>
<span class="line"><span style="color:#A6ACCD;">../.pnpm</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store/v3/tmp/dlx</span><span style="color:#F78C6C;">-4468</span><span style="color:#A6ACCD;">           | </span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">116</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">++++++++++++</span></span>
<span class="line"><span style="color:#A6ACCD;">../.pnpm</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store/v3/tmp/dlx</span><span style="color:#F78C6C;">-4468</span><span style="color:#A6ACCD;">           | Progress: resolved </span><span style="color:#F78C6C;">116</span><span style="color:#A6ACCD;">, reused </span><span style="color:#F78C6C;">74</span><span style="color:#A6ACCD;">, downloaded </span><span style="color:#F78C6C;">42</span><span style="color:#A6ACCD;">, added </span><span style="color:#F78C6C;">116</span><span style="color:#A6ACCD;">, done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;&gt;&gt;</span><span style="color:#A6ACCD;"> TURBOREPO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;&gt;&gt;</span><span style="color:#A6ACCD;"> Welcome </span><span style="color:#89DDFF;font-style:italic;">to</span><span style="color:#A6ACCD;"> Turborepo</span><span style="color:#89DDFF;">!</span><span style="color:#C792EA;"> Let</span><span style="color:#676E95;font-style:italic;">&#39;s get you set up with a new codebase.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">? Where would you like </span><span style="color:#89DDFF;font-style:italic;">to</span><span style="color:#A6ACCD;"> create your turborepo? ./my</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">turborepo</span></span>
<span class="line"><span style="color:#A6ACCD;">? Which package manager </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> you want </span><span style="color:#89DDFF;font-style:italic;">to</span><span style="color:#A6ACCD;"> use? pnpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Downloading files. This might take a moment.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;&gt;&gt;</span><span style="color:#A6ACCD;"> Created a</span><span style="color:#C792EA;"> new </span><span style="color:#A6ACCD;">Turborepo </span><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#A6ACCD;"> the following:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">apps</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> apps\\docs</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> apps\\web</span></span>
<span class="line"><span style="color:#A6ACCD;">packages</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> packages\\eslint</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">custom</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> packages\\tsconfig</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> packages\\ui</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Installing packages. This might take a couple of minutes.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;&gt;&gt;</span><span style="color:#A6ACCD;"> Success</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;"> Created a</span><span style="color:#C792EA;"> new </span><span style="color:#A6ACCD;">Turborepo at </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">my-turborepo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">Inside that directory, you can run several commands:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  pnpm run build</span></span>
<span class="line"><span style="color:#A6ACCD;">     Build all apps </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> packages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  pnpm run dev</span></span>
<span class="line"><span style="color:#A6ACCD;">     Develop all apps </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> packages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  pnpm run lint</span></span>
<span class="line"><span style="color:#A6ACCD;">     Lint all apps </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> packages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Turborepo will cache locally by </span><span style="color:#C792EA;">default</span><span style="color:#A6ACCD;">. </span><span style="color:#89DDFF;font-style:italic;">For</span><span style="color:#A6ACCD;"> an additional</span></span>
<span class="line"><span style="color:#A6ACCD;">speed boost, enable Remote Caching </span><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#A6ACCD;"> Vercel by</span></span>
<span class="line"><span style="color:#A6ACCD;">entering the following command:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  pnpm dlx turbo login</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">We suggest that you begin by typing:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  cd my</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">turborepo</span></span>
<span class="line"><span style="color:#A6ACCD;">  pnpm dlx turbo login</span></span>
<span class="line"></span></code></pre></div><p>下面的这个 turbo.json 文件定义了 3 个 task: build，lint 和 dev。</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">pipeline</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">dependsOn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">outputs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.next/**</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">!.next/cache/**</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">cache</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">persistent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>turbo run &lt;task&gt;</code>(<code>turbo &lt;task&gt; </code>)</p><p>当运行 turbo hello 会报错，因为 (turbo.json)[<a href="https://turbo.build/repo/docs/core-concepts/monorepos/running-tasks#defining-a-pipeline" target="_blank" rel="noreferrer">https://turbo.build/repo/docs/core-concepts/monorepos/running-tasks#defining-a-pipeline</a>] 中未定 hello 这个 task。</p><p>当运行 <code>turbo lint</code>，注意终端的 log，会发生下面几件事：</p><ol><li>多个脚本将同时运行，每个脚本都以 docs:lint、ui:lint 或 web:lint 开头。</li><li>它们都会成功，你将在终端中看到 3 个成功。</li><li>你还会看到缓存为 0，总数为 3。我们稍后会介绍它的含义。</li></ol><p>每个 workspace 下的 package.json。</p><p>apps/web/package.json</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">next lint</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>apps/docs/package.json</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">next lint</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>packages/ui/package.json</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">eslint </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">**/*.ts*</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>如果我们多次运行 <code>lint</code> 命令，你会在命令行中看到：</p><ol><li>出现了 <code>docs:lint</code>、<code>web:lint</code> 和 <code>ui:lint</code> 的缓存命中、重放日志。</li><li>你会看到 3 个缓存，总共 3 个。</li><li>总的运行时间应小于 100ms，并且 <code>&gt;&gt;&gt; FULL TURBO</code> 出现。</li></ol><p><code>turbo</code> 可以察觉我们的代码没有改变，它只是找到之前的日志，并且打印。</p><h3 id="发布包" tabindex="-1">发布包 <a class="header-anchor" href="#发布包" aria-hidden="true">#</a></h3><p>如果使用正确的工具，将包从 monorepo 发布到 npm 会是一种非常令人满意和流畅的体验。</p><h4 id="changesets" tabindex="-1">changesets <a class="header-anchor" href="#changesets" aria-hidden="true">#</a></h4><p>在子项目的 <code>package.json</code> 中指定 <code>private:true</code>，可以完全跳过该包的发布。</p><h2 id="pack" tabindex="-1"><a href="https://turbo.build/pack/docs" target="_blank" rel="noreferrer">pack</a> <a class="header-anchor" href="#pack" aria-hidden="true">#</a></h2><p>下一代 webpack，比 vite 还要牛？</p>`,25),e=[o];function t(c,r,D,y,C,i){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
